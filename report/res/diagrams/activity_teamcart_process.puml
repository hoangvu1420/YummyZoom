@startuml TeamCart_Process_Activity_Diagram
!theme plain

title Biểu đồ Hoạt động - Quy trình Đặt hàng Nhóm (Team Cart)

|Host (Trưởng nhóm)|
start
:Tạo Team Cart;
:Nhận Link chia sẻ;
:Gửi Link cho bạn bè;

|Member (Thành viên)|
:Nhận Link & Tham gia nhóm;

|System (Hệ thống)|
:Thêm thành viên vào Session;
:Thông báo cập nhật danh sách;

|Host (Trưởng nhóm)|
fork
    :Chọn món ăn;
fork again
    |Member (Thành viên)|
    :Chọn món ăn;
end fork

|System (Hệ thống)|
:Cập nhật giỏ hàng chung;
:Tính toán tạm tính (Subtotal);

|Member (Thành viên)|
:Xác nhận "Sẵn sàng" (Ready);

|System (Hệ thống)|
:Ghi nhận trạng thái Ready;
if (Tất cả thành viên đã Ready?) then (Rồi)
    :Thông báo cho Host "Tất cả đã sẵn sàng";
else (Chưa)
endif

|Host (Trưởng nhóm)|
:Kiểm tra danh sách món;
:Khóa giỏ hàng (Lock Cart);

|System (Hệ thống)|
:Chuyển trạng thái sang "Locked";
:Ngăn chặn thêm/sửa/xóa món;

|Host (Trưởng nhóm)|
:Áp dụng Mã giảm giá / Tip (Tùy chọn);
:Chốt giá cuối (Finalize Pricing);

|System (Hệ thống)|
:Cố định Tip/Coupon, tăng phiên bản báo giá (Quote);
:Chuyển trạng thái sang "Finalized";

|Member (Thành viên)|
:Xem số tiền cần trả;
if (Chọn phương thức thanh toán?) then (Online)
    :Thanh toán qua Cổng thanh toán;
else (Tiền mặt - COD)
    :Xác nhận cam kết trả tiền mặt;
endif

|System (Hệ thống)|
:Ghi nhận trạng thái thanh toán của Member;
if (Tất cả thành viên đã hoàn tất?) then (Chưa)
    :Chờ thành viên khác;
    detach
else (Rồi)
    :Chuyển trạng thái sang "ReadyToConfirm";
    :Kích hoạt nút "Đặt hàng" cho Host;
endif

|Host (Trưởng nhóm)|
:Nhấn "Đặt hàng" (Convert to Order);

|System (Hệ thống)|
:Tạo Đơn hàng chính thức (Order);
:Kết thúc phiên Team Cart;

stop

@enduml
